<!DOCTYPE html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700,300' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="us_state_landfill.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>

<style>

html, body {
    font-family: "Open Sans", sans-serif;
    font-size: 16px;
    padding: 10px;
}

#backPage {
  position: absolute;
  right: 0px;
  font-size: 14px;
  width: 180px;
  height: 40px;
  font-family: inherit;
  border-radius: 8px;
  border: none;
  background-color: #794d93;
  color: #f9f9f9;
  margin-bottom: 40px;
}

p {
    margin-bottom: 0px;
}

</style>

<body>
    <button id="backPage" onclick="handleBackPageClick()">&#8592; Explore Global Waste</button>
    <div id='wrapper'>
        <h1>Pickup Yo Trash America!</h1>
        <div id='side_bar' >
            <!-- info box for datavis  -->
            <div id='title_viz_instruct_text'>About:</div>
            <div class='viz_instruct_text'> The United States is the 3rd largest producer of trash in the world! This tool is to help you visualize how many tons of trash are being hauled to landfills in each state. The data used in this visualization is provided by the <a href= 'https://www.epa.gov/lmop/landfill-technical-data'>EPA</a> from March 2021.</div>
  
        <!-- input box for state search -->
            <div id='state_search_container' class='row'>
                <input id='state_search_box' type="text" placeholder="State" aria-describedby="sizing-addon2">
                <input id = "state_search_submit" type = "submit">  
            </div>
            <div id="trash_legend">
                <div id="garbage_bin" class="row">
                    <a href = '#'><img id= "legend_img" src= "images/smelly_trash.png" alt= "standard garbage bin"></a>
                    <p> Garbage Bin</p>
                    <p> 0.02 ton </p>
                </div>
                <div id="dumpster" class="row">
                    <a href = '#'><img id= "legend_img" src= "images/dumpster.png" alt= "standard garbage bin"></a>
                    <p>Dumpster</p>
                    <p> 0.6 ton  </p>
                </div>
            </div> 
            <div id= 'human-height-index'>
                <div id="human1" class="row">
                    <img id= "black-man" src= "images/black-man.png" alt= "Black man">
                    <p> 5'8 </p>
                </div>
                <div id="human2" class="row">
                    <img id= "white-woman" src= "images/white-woman.png" alt= "White woman">
                    <p> 5'4 </p>
                </div>
            </div>  
        </div>
        
        <!-- TRASH DUMP ZONE -->
        <div id='trash_dump_container' display="block">
            <div id="svg_id"></div>
        </div>
    </div>  
        
    </div>

    <!-- <p id = "datacite" style= "font-size: 11px;" text-align="center">Created by: Helen Li, Kalyn Bowen and Yuji Chan.</p> -->

   
<!-- <script src="//d3js.org/d3.v3.min.js"></script> -->
<script src="//d3js.org/queue.v1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.9.1/d3-tip.js"></script>
<script src="https://raw.githack.com/jamesleesaunders/d3-ez/master/dist/d3-ez.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>
<!-- <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script> -->
<script
  src="https://code.jquery.com/jquery-1.9.1.js"
  integrity="sha256-e9gNBsAcA0DBuRWbm0oZfbiCyhjLrI6bmqAl5o+ZjUA="
  crossorigin="anonymous"></script>
<script
  src="https://code.jquery.com/ui/1.10.3/jquery-ui.js"
  integrity="sha256-ugED92WALymbx9ylw12aADWaCrsQysE29DyvnAv5i3w="
  crossorigin="anonymous"></script>
  
<script>

state_id_to_name = {
    AL: "Alabama",
    AK: "Alaska",
    AS: "American Samoa",
    AZ: "Arizona",
    AR: "Arkansas",
    CA: "California",
    CO: "Colorado",
    CT: "Connecticut",
    DE: "Delaware",
    DC: "District Of Columbia",
    FL: "Florida",
    GA: "Georgia",
    GU: "Guam",
    HI: "Hawaii",
    ID: "Idaho",
    IL: "Illinois",
    IN: "Indiana",
    IA: "Iowa",
    kS: "Kansas",
    KY: "Kentucky",
    LA: "Louisiana",
    ME: "Maine",
    MD: "Maryland",
    MA: "Massachusetts",
    MI: "Michigan",
    MN: "Minnesota",
    MS: "Mississippi",
    MO: "Missouri",
    MT: "Montana",
    NE: "Nebraska",
    NV: "Nevada",
    NH: "New Hampshire",
    NJ: "New Jersey",
    NM: "New Mexico",
    NY: "New York",
    NC: "North Carolina",
    ND: "North Dakota",
    OH: "Ohio",
    OK: "Oklahoma",
    OR: "Oregon",
    PW: "Palau",
    PA: "Pennsylvania",
    PR: "Puerto Rico",
    RI: "Rhode Island",
    SC: "South Carolina",
    SD: "South Dakota",
    TN: "Tennessee",
    TX: "Texas",
    UT: "Utah",
    VT: "Vermont",
    VI: "Virgin Islands",
    VA: "Virginia",
    WA: "Washington",
    WV: "West Virginia",
    WI: "Wisconsin",
    WY: "Wyoming"
}

function handleBackPageClick() { // handling the back button to the global page
  url = window.location.href
  newurl = url.split('/').slice(0,-1).join('/')+'/polar_area_chart.html'
  window.location.href = newurl
}

/************* general GLOBAL variables here *************/
landfill_by_state = {} //total landfills in each state (Arkansas: 4)

var width = 1200, height = 600;
barHeight = height / 2 - 40
total_waste = 0
continue_display = true

// var trash_type = trash_bin

/************* PROCESS DATA ***********/
d3.csv("data_resources/state_landfill_mar2021.csv", function(error, data) {
  data.forEach(d => {
    let state_name = state_id_to_name[d.us_state]
    let landfill = d.landfill_name
    if (!(state_name in landfill_by_state)) {
      landfill_by_state[state_name] = {total_waste: 0, landfills: new Array(0)};
    } 
    landfill_by_state[state_name]['total_waste'] += d.annual_waste_acceptance.replace(/,/g, "") ? parseInt(d.annual_waste_acceptance.replace(/,/g, "")) : 0;
    landfill_by_state[state_name]['daily_waste'] =  (landfill_by_state[state_name]['total_waste'] / 365);
    landfill_by_state[state_name]['hourly_waste']= (landfill_by_state[state_name]['total_waste'] / 8760);
    landfill_by_state[state_name]['minute_waste']= (landfill_by_state[state_name]['hourly_waste'] / 60);
    landfill_by_state[state_name]['secondly_waste']= (landfill_by_state[state_name]['minute_waste'])/60;
    
    landfill_by_state[state_name]['landfills'].push(d);

    d3.select('#state_search_box').on("keyup", function() {
        gSearch();
        });
    });
});

/************* SEARCH BOX ***********/
// jQuery-ui auto-complete;
function gSearch() {
    state_list = Object.keys(landfill_by_state);
    $('#state_search_box').autocomplete({
        source: state_list,
        minLength: 1,      // begin auto-complete after (x) characters
        scroll: true
    })
    window.search = function () {
        var a = document.getElementById('input').value;
    }
}

function image_out () {
    var UserSearchBoxSelection = document.getElementById('state_search_box').value;
    // 1 ton = 2000 pounds
    // 31 gallons per bin = 35 lbs per bin = 57 bins per ton
    var trash_cans_min = parseInt(landfill_by_state[UserSearchBoxSelection]['minute_waste'] * 57);
    var trash_cans_sec = parseInt(landfill_by_state[UserSearchBoxSelection]['secondly_waste'] * 57);
    // creating bin imgs   
    var bins = document.createElement('img')
        bins.setAttribute("src", "images/smelly_trash.png");
        bins.setAttribute("style", "width: 40px");
    // creating dumpster imgs
    var dumpster = document.createElement('img')
        dumpster.setAttribute("src", "images/dumpster.png");
        dumpster.setAttribute("style", "width: 100px");
    // delete all child trash cans of this parent div
    var node= document.getElementById("trash_dump_container"); 
    node.querySelectorAll('*').forEach(n => n.remove());
    var listStatement = document.createElement("h2");
    var listItem = document.createElement("div");
    // Adds trash bins based on number count!
    let num_trash_cans = trash_cans_min >= 200 ? trash_cans_sec : trash_cans_min;
    console.log(num_trash_cans);
    for(i = 0; i < num_trash_cans; i++){
        var listItemSize = d3.select('body').append('svg')
        listItem.innerHTML += bins.outerHTML;  
    }
    if (num_trash_cans ==trash_cans_min) {
            listStatement.innerHTML += document.getElementById('state_search_box').value + " produces " + trash_cans_min + " bins of garbage a minute!";
        }
        else {
            listStatement.innerHTML += document.getElementById('state_search_box').value + " produces " + trash_cans_sec + " bins of garbage every second!";
        };
    document.getElementById("trash_dump_container").appendChild(listStatement);
    document.getElementById("trash_dump_container").appendChild(listItem);
}

/************* ADD IMAGES BASED ON STATE LANDFILLS NUM ***********/
d3.select("#state_search_submit").on("click", function() {  //Keyup function to convert user input to a filter value
    image_out();
}); 

d3.select("#dumpster").on("click", function() {
    image_out();
});


//make click listener function out here for dumpster to run the global variable
</script>

</body>
</html>