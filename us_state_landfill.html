<!DOCTYPE html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700,300' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="us_state_landfill.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>

<style>
body {
  font-family: "Open Sans", sans-serif;
  font-size: 16px;
  padding: 20px;
}

#backPage {
  position: absolute;
  right: 0px;
  font-size: 14px;
  width: 180px;
  height: 40px;
  font-family: inherit;
  border-radius: 8px;
  border: none;
  background-color: #794d93;
  color: #f9f9f9;
  margin-bottom: 40px;
}

</style>

<body>
    <button id="backPage" onclick="handleBackPageClick()">&#8592; Explore Global Waste</button>
    <div id='wrapper'>
        <h1>Pickup Yo Trash America!</h1>
        <div id='side_bar' >
            <!-- info box for datavis  -->
            <div id='title_viz_instruct_text'>About:</div>
            <div class='viz_instruct_text'> The United States is the 3rd largest producer of trash in the world! This tool is to help you visualize how many tons of trash are being hauled to landfills in each state. The data used in this visualization is provided by the <a href= 'https://www.epa.gov/lmop/landfill-technical-data'>EPA</a> from March 2021.</div>
  
        <!-- input box for state search -->
            <div id='state_search_container' class='row'>
                <input id='state_search_box' type="text" placeholder="State" aria-describedby="sizing-addon2">
                <input id = "state_search_submit" type = "submit">  
            </div>
            <div id="trash_legend">
                <div id="garbage_bin" class="row">
                    <img id= "legend_img" src= "images/smelly_trash.png" alt= "standard garbage bin">
                    <p> Garbage Bin</p>
                    <p> 0.008 ton </p>
                </div>
                <div id="dumpster" class="row">
                    <img id= "legend_img" src= "images/dumpster.png" alt= "standard garbage bin">
                    <p>Dumpster</p>
                    <p> 0.6 ton  </p>
                </div>
            </div>   
        </div>
        
        <!-- TRASH DUMP ZONE -->
        <div id='trash_dump_container' display="block">
            <div id="svg_id"></div>
        </div>
    </div>  
        
    </div>

    <!-- <p id = "datacite" style= "font-size: 11px;" text-align="center">Created by: Helen Li, Kalyn Bowen and Yuji Chan.</p> -->

   
<!-- <script src="//d3js.org/d3.v3.min.js"></script> -->
<script src="//d3js.org/queue.v1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.9.1/d3-tip.js"></script>
<script src="https://raw.githack.com/jamesleesaunders/d3-ez/master/dist/d3-ez.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>
<!-- <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script> -->
<script
  src="https://code.jquery.com/jquery-1.9.1.js"
  integrity="sha256-e9gNBsAcA0DBuRWbm0oZfbiCyhjLrI6bmqAl5o+ZjUA="
  crossorigin="anonymous"></script>
<script
  src="https://code.jquery.com/ui/1.10.3/jquery-ui.js"
  integrity="sha256-ugED92WALymbx9ylw12aADWaCrsQysE29DyvnAv5i3w="
  crossorigin="anonymous"></script>
  
<script>

state_id_to_name = {
    AL: "Alabama",
    AK: "Alaska",
    AS: "American Samoa",
    AZ: "Arizona",
    AR: "Arkansas",
    CA: "California",
    CO: "Colorado",
    CT: "Connecticut",
    DE: "Delaware",
    DC: "District Of Columbia",
    FL: "Florida",
    GA: "Georgia",
    GU: "Guam",
    HI: "Hawaii",
    ID: "Idaho",
    IL: "Illinois",
    IN: "Indiana",
    IA: "Iowa",
    kS: "Kansas",
    KY: "Kentucky",
    LA: "Louisiana",
    ME: "Maine",
    MD: "Maryland",
    MA: "Massachusetts",
    MI: "Michigan",
    MN: "Minnesota",
    MS: "Mississippi",
    MO: "Missouri",
    MT: "Montana",
    NE: "Nebraska",
    NV: "Nevada",
    NH: "New Hampshire",
    NJ: "New Jersey",
    NM: "New Mexico",
    NY: "New York",
    NC: "North Carolina",
    ND: "North Dakota",
    OH: "Ohio",
    OK: "Oklahoma",
    OR: "Oregon",
    PW: "Palau",
    PA: "Pennsylvania",
    PR: "Puerto Rico",
    RI: "Rhode Island",
    SC: "South Carolina",
    SD: "South Dakota",
    TN: "Tennessee",
    TX: "Texas",
    UT: "Utah",
    VT: "Vermont",
    VI: "Virgin Islands",
    VA: "Virginia",
    WA: "Washington",
    WV: "West Virginia",
    WI: "Wisconsin",
    WY: "Wyoming"
}

function handleBackPageClick() { // handling the back button to the global page
  url = window.location.href
  newurl = url.split('/').slice(0,-1).join('/')+'/polar_area_chart.html'
  window.location.href = newurl
}

/************* general GLOBAL variables here *************/
landfill_by_state = {} //total landfills in each state (Arkansas: 4)

var width = 1200, height = 600;
barHeight = height / 2 - 40
total_waste = 0
continue_display = true

/************* PROCESS DATA ***********/
d3.csv("data_resources/state_landfill_mar2021.csv", function(error, data) {
  data.forEach(d => {
    let state_name = state_id_to_name[d.us_state]
    let landfill = d.landfill_name
    if (!(state_name in landfill_by_state)) {
      landfill_by_state[state_name] = {total_waste: 0, landfills: new Array(0)};
    } 
    landfill_by_state[state_name]['total_waste'] += d.annual_waste_acceptance.replace(/,/g, "") ? parseInt(d.annual_waste_acceptance.replace(/,/g, "")) : 0;
    landfill_by_state[state_name]['daily_waste'] =  parseInt(landfill_by_state[state_name]['total_waste'] / 365);
    landfill_by_state[state_name]['hourly_waste']= parseInt(landfill_by_state[state_name]['total_waste'] / 8760);
    landfill_by_state[state_name]['minute_waste']= parseInt(landfill_by_state[state_name]['hourly_waste'] / 60);
    //landfill_by_state[state_name]['secondly_waste']= parseInt(landfill_by_state[state_name]['minute_waste'] / 60);

    landfill_by_state[state_name]['landfills'].push(d);

    d3.select('#state_search_box').on("keyup", function() {
        gSearch();
        });
    });
});


/************* SEARCH BOX ***********/
// jQuery-ui auto-complete;
function gSearch() {
    state_list = Object.keys(landfill_by_state);
    $('#state_search_box').autocomplete({
        source: state_list,
        minLength: 1,      // begin auto-complete after (x) characters
        scroll: true
    })
    window.search = function () {
        var a = document.getElementById('input').value;
    }
}

/************* ADD IMAGES BASED ON STATE LANDFILLS NUM ***********/
d3.select("#state_search_submit").on("click", function() {  //Keyup function to convert user input to a filter value
    var UserSearchBoxSelection = document.getElementById('state_search_box').value;
    var trash_can_num = parseInt(landfill_by_state[UserSearchBoxSelection]['minute_waste'] * 133);
    var img = document.createElement('img')
        img.setAttribute("src", "images/smelly_trash.png");
        img.setAttribute("style", "width:60px");
    var w = window,
        x = w.innerWidth,  //|| e.clientWidth || g.clientWidth,
        y = w.innerHeight; //|| e.clientHeight || g.clientHeight;
    //console.log(trash_can_num)
    var node= document.getElementById("trash_dump_container"); // delete all child trash cans of this parent div
    node.querySelectorAll('*').forEach(n => n.remove());
    var listStatement = document.createElement("h2");
    var listItem = document.createElement("div");
    for(i = 0; i < trash_can_num; i++){
        var listItemSize = d3.select('body').append('svg')
                           .attr("width", x)
                           .attr("height", y);
                           //.append("g");
        listItem.innerHTML += img.outerHTML;
    }
    
    listStatement.innerHTML += document.getElementById('state_search_box').value + " produces " + trash_can_num + " bins of garbage a minute!";
    document.getElementById("trash_dump_container").appendChild(listStatement);
    document.getElementById("trash_dump_container").appendChild(listItem);

    //console.log(i)
}); 

</script>

</body>
</html>