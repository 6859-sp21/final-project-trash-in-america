<!DOCTYPE html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700,300' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="us_state_landfill.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>

<style>
body {
  font-family: "Open Sans", sans-serif;
  font-size: 16px;
  padding: 20px;
}

#backPage {
  position: absolute;
  right: 0px;
  font-size: 14px;
  width: 180px;
  height: 40px;
  font-family: inherit;
  border-radius: 8px;
  border: none;
  background-color: #794d93;
  color: #f9f9f9;
  margin-bottom: 40px;
}

</style>

<body>
    <button id="backPage" onclick="handleBackPageClick()">&#8592; Explore Global Waste</button>
    <div id='wrapper'>
        <h1>Pickup Yo Trash America!</h1>
        
        <div id='clust_instruct_container' >
            <!-- info box for datavis  -->
            <div id='title_viz_instruct_text'>About:</div>
            <div class='viz_instruct_text'> This tool is to help you visualize how much trash is being hauled to landfills. The unit of measure is in tons.  Search any state and choose your metric: trash bin, dumpster or garbage truck. The data used in this visualization is provided by the <a href= 'https://www.epa.gov/lmop/landfill-technical-data'>EPA</a> from March 2021.  
        </div>

        <!-- input box for state search -->
        <div id='state_search_container' class='row'>
            <input id='state_search_box' type="text" class="form-control" placeholder="e.g. California" aria-describedby="sizing-addon2">
            <div id='gene_search_button' class="btn-group" data-toggle="buttons" >
            <label id='gene_search_submit' class="btn btn-primary active " onclick="return_state_info();">
                <input type="radio" name="options" id="" autocomplete="off" checked > Search
            </label>
            </div>
        </div>
        </div>  
    </div>

    <p id = "datacite">Created by: Helen Li, Kalyn Bowen and Yuji Chan.</p>

   
<!-- <script src="//d3js.org/d3.v3.min.js"></script> -->
<script src="//d3js.org/queue.v1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.9.1/d3-tip.js"></script>
<script src="https://raw.githack.com/jamesleesaunders/d3-ez/master/dist/d3-ez.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script>

state_id_to_name = {
    AL: "Alabama",
    AK: "Alaska",
    AS: "American Samoa",
    AZ: "Arizona",
    AR: "Arkansas",
    CA: "California",
    CO: "Colorado",
    CT: "Connecticut",
    DE: "Delaware",
    DC: "District Of Columbia",
    FL: "Florida",
    GA: "Georgia",
    GU: "Guam",
    HI: "Hawaii",
    ID: "Idaho",
    IL: "Illinois",
    IN: "Indiana",
    IA: "Iowa",
    kS: "Kansas",
    KY: "Kentucky",
    LA: "Louisiana",
    ME: "Maine",
    MD: "Maryland",
    MA: "Massachusetts",
    MI: "Michigan",
    MN: "Minnesota",
    MS: "Mississippi",
    MO: "Missouri",
    MT: "Montana",
    NE: "Nebraska",
    NV: "Nevada",
    NH: "New Hampshire",
    NJ: "New Jersey",
    NM: "New Mexico",
    NY: "New York",
    NC: "North Carolina",
    ND: "North Dakota",
    OH: "Ohio",
    OK: "Oklahoma",
    OR: "Oregon",
    PW: "Palau",
    PA: "Pennsylvania",
    PR: "Puerto Rico",
    RI: "Rhode Island",
    SC: "South Carolina",
    SD: "South Dakota",
    TN: "Tennessee",
    TX: "Texas",
    UT: "Utah",
    VT: "Vermont",
    VI: "Virgin Islands",
    VA: "Virginia",
    WA: "Washington",
    WV: "West Virginia",
    WI: "Wisconsin",
    WY: "Wyoming"
}

function handleBackPageClick() { // handling the back button to the global page
  url = window.location.href
  newurl = url.split('/').slice(0,-1).join('/')+'/polar_area_chart.html'
  window.location.href = newurl
}

/************* general GLOBAL variables here *************/
landfill_by_state = {} //total landfills in each state (Arkansa: 4)
landfill_by_state_list = []

var width = 1200, height = 600;
barHeight = height / 2 - 40
total_waste = 0
continue_display = true

/************* PROCESS DATA ***********/
d3.csv("data_resources/state_landfill_mar2021.csv", function(error, data) {
  data.forEach(d => {
    let state_name = state_id_to_name[d.us_state]
    let landfill = d.landfill_name
    if (!(state_name in landfill_by_state)) {
      landfill_by_state[state_name] = {total_waste: 0, landfills: new Array(0)};
    } 
    landfill_by_state[state_name]['total_waste'] += d.annual_waste_acceptance.replace(/,/g, "") ? parseInt(d.annual_waste_acceptance.replace(/,/g, "")) : 0;
    landfill_by_state[state_name]['daily_waste'] =  parseInt(landfill_by_state[state_name]['total_waste'] / 365);
    landfill_by_state[state_name]['hourly_waste']= parseInt(landfill_by_state[state_name]['total_waste'] / 8760);
    landfill_by_state[state_name]['landfills'].push(d);

    d3.select('#state_search_box').on("keyup", function() {
        gSearch();
        });
})
/************* SEARCH BOX ***********/
//jQuery-ui auto-complete
    function gSearch() {
        state_list = Object.keys(landfill_by_state);
        
        $('#state_search_box').autocomplete({
        source: state_list,
        minLength: 1,      // begin auto-complete after (x) characters
        scroll: true
        }).focus(function() {
        $(this).autocomplete("search", "");
        });
    }
    d3.select("#gene_search_button").on("click", function() {  //Keyup function to convert user input to a filter value
        var UserSearchBoxSelection = document.getElementById('mySearchBox').value
            var userSelection = data.filter(function(d) {return d.State == UserSearchBoxSelection;});
            d3.selectAll("p").remove() // remove table upon new user selection

    var p = d3.select('body').append('p');
        p.selectAll('p')
        .data(userSelection)
        .enter()
        .append('p')
        .html(function(d) { return 'State: ' + d.State + '</br>' + 'YTD Housing Starts: '+ d['YTD Housing Starts']; })

      });

    console.log(landfill_by_state)
    //console.log(total_waste)
});



// // find gene in clustergram 
// function find_gene_in_clust(){
//   // get the searched gene 
//   search_gene = $('#gene_search_box').val();

//   if (all_genes.indexOf(search_gene) != -1){
//     // zoom and highlight found gene 
//     /////////////////////////////////
//     zoom_and_highlight_found_gene(search_gene);
    
//   }

// };
</script>

</body>
</html>